<?php

require_once "config.php";

if(!empty($_FILES['fileToUpload'])){
    $path = "uploads/";
    $filename = $_FILES['fileToUpload']['name'];
    $path = $path . basename($filename);
    $ext = pathinfo($filename, PATHINFO_EXTENSION);
    
    if ($ext === 'txt'){
        if (move_uploaded_file($_FILES['fileToUpload']['tmp_name'], $path)) {
            if (isset($_REQUEST["patient_name"])){
                $patient_name = trim($_REQUEST["patient_name"]);
                $query = "INSERT INTO patients (patient_name, patient_data, patient_stats, doc_id, pfile) VALUES (?, ?, ?, ?, ?)";
                if ($stmt = mysqli_prepare($link, $query)) {
                    mysqli_stmt_bind_param($stmt, "sssis", $p_pname, $p_pdata, $p_pstats, $p_pdocid, $p_pfile);
                    $p_pname = $patient_name;
                    $p_pdata = '[[155, 146, 148, 182, 119, 121, 152, 148, 194, 160, 124, 185, 160, 117, 186, 147, 133, 165, 110, 125, 156, 112, 177, 191, 103, 109, 175, 124, 189, 148, 176, 117, 106, 184, 193, 167, 150, 153, 141, 175, 176, 127, 166, 129, 166, 162, 175, 116, 174, 181, 116, 144, 150, 103, 106, 133, 153, 192, 183, 178, 127, 151, 125, 162, 161, 155, 147, 119, 148, 107, 154, 139, 136, 194, 199, 164, 160, 109, 116, 101, 159, 183, 193, 116, 126, 153, 186, 140, 129, 137, 113, 166, 198, 107, 120, 130, 105, 181, 145, 127, 140, 191, 106, 177, 112, 136, 112, 180, 195, 110, 183, 111, 107, 152, 156, 140, 196, 157, 165, 180, 151, 121, 146, 159, 129, 185, 132, 175, 154, 179, 125, 182, 166, 197, 108, 197, 188, 127, 154, 169, 148, 116, 156, 148, 139, 158, 170, 147, 186, 167, 116, 120, 156, 105, 165, 122, 193, 147, 153, 171, 191, 180, 156, 120, 173, 139, 196, 197, 194, 121, 191, 117, 176, 134, 117, 191, 131, 163, 174, 159, 110, 109, 184, 174, 102, 155, 182, 190, 133, 146, 181, 181, 135, 155, 182, 109, 173, 137, 179, 154, 192, 129, 123, 135, 160, 178, 127, 122, 173, 130, 138, 108, 101, 121, 175, 126, 154, 116, 186, 157, 172, 136, 125, 158, 141, 156, 168, 158, 197, 145, 138, 123, 193, 133, 109, 143, 163, 195, 188, 143, 149, 164, 143, 119, 138, 187, 175, 124, 130, 169, 102, 191, 112, 199, 154, 132, 108, 106, 123, 154, 149, 102, 175, 147, 167, 147, 137, 160, 170, 183, 124, 166, 135, 113, 151, 167, 116, 101, 139, 129, 151, 111, 123, 193, 108, 188, 197, 189, 130, 158, 112, 177, 196, 113, 124, 131, 102, 182, 158, 164, 191, 147, 151, 141, 128, 175, 152, 172, 123, 102, 146, 137, 119, 174, 170, 140, 180, 105, 158, 137, 153, 109, 102, 105, 121, 170, 198, 114, 124, 173, 130, 136, 154, 182, 180, 134, 103, 137, 138, 175, 142, 187, 135, 171, 167, 156, 171, 123, 109, 170, 155, 196, 152, 163, 197, 167, 195, 154, 128, 190, 160, 122, 104, 112, 147, 187, 197, 181, 102, 188, 121, 160, 188, 105, 100, 183, 120, 140, 187, 108, 105, 176, 150, 130, 132, 182, 175, 130, 168, 105, 182, 195, 191, 131, 198, 137, 175, 119, 183, 195, 140, 173, 133, 178, 127, 109, 163, 108, 140, 169, 185, 185, 131, 177, 162, 116, 188, 134, 181, 125, 170, 197, 188, 119, 181, 198, 189, 150, 197, 158, 185, 166, 150, 132, 191, 149, 152, 117, 101, 197, 110, 193, 181, 100, 181, 112, 149, 124, 139, 151, 117, 165, 163, 199, 143, 177, 169, 135, 142, 189, 134, 123, 143, 128, 151, 135, 123, 123, 151, 161, 134, 129, 173, 183, 101, 172, 155, 115, 124, 188, 163, 136, 199, 112, 109, 199, 158, 148, 158, 176, 192, 109, 157, 193, 112, 168, 113, 146, 162, 179, 174, 196, 102, 155, 165, 178, 159, 172, 167, 122, 162, 165, 172, 117, 117, 168, 159, 104, 193, 197, 126, 105, 165, 112, 147, 166, 154, 143, 105, 177, 110, 123, 132, 124, 151, 174, 130, 148, 157, 148, 161, 120, 186, 106, 176, 166, 140, 102, 119, 180, 154, 120, 124, 146, 120, 153, 175, 112, 168, 161, 106, 178, 122, 123, 156, 168, 149, 143, 154, 198, 199, 133, 189, 136, 184, 150, 147, 160, 164, 159, 112, 186, 104, 116, 191, 148, 128, 134, 199, 185, 187, 190, 189, 198, 165, 192, 116, 122, 112, 174, 143, 182, 199, 188, 134, 180, 123, 192, 141, 116, 153, 185, 168, 122, 173, 117, 178, 114, 130, 194, 115, 140, 151, 152, 148, 177, 158, 169, 123, 108, 140, 135, 178, 125, 198, 103, 143, 134, 133, 156, 108, 187, 116, 118, 117, 105, 110, 185, 190, 130, 195, 186, 139, 170, 182, 161, 195, 154, 170, 104, 139, 133, 150, 156, 136, 104, 187, 145, 185, 127, 126, 157, 181, 118, 109, 120, 149, 107, 141, 150, 184, 159, 167, 154, 134, 147, 193, 137, 106, 168, 180, 142, 106, 105, 116, 178, 195, 159, 180, 157, 148, 181, 181, 146, 195, 179, 194, 193, 147, 187, 186, 199, 135, 164, 169, 131, 194, 192, 168, 112, 178, 120, 194, 102, 129, 173, 124, 176, 129, 158, 192, 179, 113, 108, 191, 112, 114, 108, 129, 182, 126, 157, 103, 132, 100, 110, 148, 197, 177, 198, 192, 121, 146, 127, 102, 126, 185, 179, 130, 124, 166, 141, 186, 124, 160, 124, 190, 101, 178, 127, 187, 194, 124, 137, 105, 104, 115, 174, 164, 141, 148, 183, 155, 132, 111, 116, 185, 127, 123, 100, 173, 164, 136, 122, 181, 160, 145, 109, 194, 163, 132, 127, 199, 194, 159, 133, 140, 157, 115, 173, 176, 180, 119, 108, 137, 185, 135, 156, 164, 113, 115, 104, 133, 176, 119, 162, 113, 120, 167, 177, 171, 190, 143, 147, 177, 118, 168, 166, 153, 183, 112, 104, 164, 151, 156, 157, 195, 142, 109, 179, 173, 161, 128, 196, 179, 129, 154, 195, 183, 138, 109, 146, 192, 167, 101, 180, 130, 153, 151, 100, 139, 105, 131, 159, 176, 195, 104, 199, 132, 116, 162, 119, 189, 119, 165, 186, 180, 162, 161, 192, 159, 158, 127, 120, 121, 122, 155, 147, 152, 189, 165, 145, 177, 150, 113, 193, 136, 108, 192, 149, 176, 158, 114, 103, 175, 142, 160, 115, 188, 141, 147, 161, 188, 158, 111, 105, 170, 189, 137, 106, 121, 182, 164, 147, 126, 196, 192, 161, 178, 102, 168, 146, 118, 145, 142, 163, 127, 194, 152, 117, 140, 124, 177, 138, 180, 150, 194, 137, 159, 110, 141, 176, 115, 146, 155, 171, 172, 151, 148, 100, 142, 165, 164, 181, 116, 193, 149, 152, 106, 109, 165, 116, 110, 115, 128, 152, 132, 164, 101, 162, 110, 196, 154, 108, 182, 179, 122, 142, 130, 138], [21, 82, 69, 46, 22, 27, 46, 97, 1, 40, 40, 52, 67, 8, 26, 15, 87, 72, 86, 64, 28, 93, 13, 44, 87, 47, 69, 25, 8, 76, 61, 13, 99, 75, 52, 21, 63, 91, 78, 77, 56, 34, 25, 13, 81, 35, 83, 76, 56, 30, 98, 18, 6, 46, 80, 32, 69, 8, 68, 37, 98, 35, 2, 22, 15, 12, 29, 99, 54, 54, 16, 92, 5, 18, 41, 33, 63, 3, 29, 60, 33, 76, 4, 4, 98, 51, 69, 76, 63, 78, 88, 89, 35, 77, 65, 13, 57, 6, 7, 51, 94, 59, 83, 74, 68, 20, 19, 15, 68, 76, 2, 49, 41, 63, 87, 35, 24, 30, 11, 93, 15, 13, 38, 44, 51, 53, 55, 21, 74, 29, 44, 60, 77, 10, 5, 61, 13, 50, 2, 42, 69, 56, 31, 49, 20, 59, 39, 56, 90, 25, 23, 15, 46, 79, 68, 22, 34, 52, 56, 41, 66, 90, 95, 90, 20, 35, 48, 38, 0, 72, 22, 51, 41, 0, 4, 45, 89, 24, 20, 7, 85, 0, 1, 6, 49, 7, 65, 52, 37, 8, 49, 29, 67, 27, 85, 15, 48, 73, 82, 79, 92, 3, 69, 31, 16, 30, 59, 26, 96, 26, 73, 44, 73, 41, 20, 8, 89, 21, 89, 50, 86, 37, 18, 69, 57, 94, 38, 87, 87, 97, 42, 57, 18, 81, 39, 30, 81, 8, 48, 79, 51, 33, 6, 49, 90, 78, 50, 56, 66, 53, 7, 36, 24, 22, 47, 67, 23, 42, 58, 95, 59, 70, 10, 36, 63, 52, 52, 75, 9, 41, 32, 31, 92, 84, 69, 28, 6, 6, 91, 76, 92, 47, 61, 79, 32, 45, 76, 23, 92, 79, 90, 55, 73, 18, 33, 31, 76, 72, 88, 6, 24, 15, 44, 59, 26, 20, 36, 34, 43, 29, 82, 71, 82, 29, 80, 56, 75, 3, 16, 47, 80, 49, 39, 7, 49, 97, 24, 65, 97, 5, 55, 71, 71, 14, 9, 62, 28, 85, 56, 37, 91, 35, 27, 3, 49, 16, 52, 3, 78, 66, 8, 89, 38, 35, 6, 52, 76, 31, 33, 7, 80, 76, 72, 38, 11, 96, 89, 71, 93, 96, 78, 62, 69, 87, 37, 30, 78, 82, 23, 30, 91, 83, 54, 54, 42, 49, 92, 2, 1, 77, 82, 38, 62, 84, 98, 47, 74, 41, 65, 32, 12, 40, 81, 8, 37, 32, 99, 70, 83, 66, 79, 23, 57, 53, 92, 73, 26, 67, 27, 60, 59, 60, 99, 10, 13, 53, 75, 27, 50, 89, 43, 66, 52, 24, 82, 77, 68, 72, 45, 54, 84, 35, 84, 37, 89, 58, 38, 27, 23, 54, 74, 38, 29, 29, 49, 36, 6, 41, 14, 32, 29, 2, 11, 32, 72, 88, 6, 46, 45, 52, 58, 35, 56, 10, 50, 54, 21, 11, 78, 43, 26, 34, 43, 10, 8, 79, 82, 9, 14, 33, 43, 57, 20, 36, 15, 33, 61, 8, 20, 19, 7, 91, 92, 63, 7, 95, 30, 75, 31, 77, 16, 49, 32, 88, 52, 47,
52, 32, 58, 2, 72, 36, 70, 19, 33, 92, 24, 61, 38, 41, 99, 46, 98, 44, 0, 25, 50, 44, 12, 88, 77, 39, 49, 82, 97, 53, 26, 94, 46, 94, 51, 70, 98, 36, 52, 57, 39, 69, 14, 26, 59, 95, 93, 39, 61, 29, 37, 73, 34, 55, 49, 57, 76, 0, 33, 11, 87, 75, 44, 29, 91, 95, 52, 21, 87, 26, 46, 73, 92, 73, 37, 1, 93, 68, 66, 62, 58, 13, 34, 27, 30, 58, 83, 13, 19, 33, 70, 99, 12, 90, 31, 55, 33, 85, 89, 32, 74, 22, 4, 20, 80, 3, 33, 64, 74, 93, 90, 7, 80, 78, 33, 81, 84, 5, 55, 87, 69, 20, 17, 29, 47, 46, 98, 11, 68, 87, 10, 98, 36, 79, 6, 14, 74, 54, 50, 59, 28, 22, 17, 34, 79, 69,
64, 34, 2, 66, 96, 22, 54, 68, 15, 63, 74, 49, 6, 96, 37, 68, 40, 79, 40, 85, 59, 48, 9, 70, 61, 93, 18, 30, 86, 75, 2, 57, 70, 91, 37, 38, 88, 25, 90, 19, 55, 72, 36, 29, 15, 37, 15, 56, 79, 50, 17, 98, 77, 66, 28, 3, 90, 52, 60, 25, 27, 6, 88, 17, 36, 75, 84, 19, 90, 52, 13, 81, 87, 23, 50, 9, 61, 35, 75, 85, 31, 61, 56, 59, 16, 38, 55, 91,
88, 78, 5, 70, 19, 50, 65, 29, 7, 66, 33, 80, 86, 20, 47, 84, 58, 34, 76, 11, 38, 13, 99, 35, 31, 76, 14, 57, 50, 87, 21, 48, 21, 95, 41, 47, 52, 41, 49, 66, 88, 38, 48, 38, 57, 10, 56, 91, 1, 92, 69, 12, 51, 78, 73, 12, 69, 9, 92, 15, 53, 3, 88, 67, 36, 18, 70, 27, 48, 61, 85, 16, 84, 87, 84, 43, 83, 39, 69, 38, 90, 46, 64, 86, 56, 59, 69, 74, 91, 27, 83, 78, 89, 18, 46, 54, 22, 60, 38, 30, 60, 42, 28, 58, 29, 66, 97, 29, 85, 93, 18, 29, 8, 93, 77, 0, 99, 52, 69, 64, 70, 86, 42, 98, 61, 84, 9, 92, 28, 53, 54, 1, 76, 83, 18, 94, 97, 91, 68, 99, 82, 30, 19, 39, 92, 62,
36, 52, 19, 16, 41, 36, 82, 59, 45, 90, 71, 32, 40, 88, 80, 13, 9, 96, 71, 4, 95, 45, 22, 8, 44, 93, 69, 83, 79, 93, 80, 65, 63, 73, 39, 44, 64, 91, 31, 70, 55, 47, 39, 54, 6, 1, 67, 77, 98, 95, 28, 84, 49, 39, 63, 89, 89, 48, 5,
43, 12, 41, 20, 99, 27, 71, 67, 84, 27, 99, 95, 88, 43, 95, 30, 38, 73, 7, 31, 83, 30, 41, 82, 2, 79, 20, 79, 97, 55, 15, 37, 12, 17, 36, 84, 64, 63, 14, 83, 68, 85, 74, 11, 45]]';

                    $a = array(1, 2, 3);
                    $random_keys = array_rand($a, 2);
                    
                    $p_pstats = '{"Label": '.$a[$random_keys[0]].'}';
                    $p_pdocid = 1;
                    $p_pfile = $filename;
                    mysqli_stmt_execute($stmt);
                    mysqli_stmt_close($stmt);
                }
            }
            mysqli_close($link);
            header('Location: ./app.php');
        }
    }
}

?>